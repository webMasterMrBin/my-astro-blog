---
title: react SWR æ•°æ®è¯·æ±‚åº“æµ…æ
pubDate: 2023-11-22
intro: å­¦ä¹ reactä¸­ä¼˜ç§€çš„æ•°æ®è¯·æ±‚åº“SWRçš„åŠŸèƒ½å’Œè®¾è®¡
tag: react
author: lbsong
image: ../../assets/swr/icon.png
readTime: '10'
---

äº†è§£SWRçš„åŠŸèƒ½å’Œä½œç”¨å‰, å…ˆè®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„reactç»„ä»¶ä¸­æ ‡å‡†çš„ä¸€å¥—æ•°æ®è¯·æ±‚æµç¨‹

## æ ‡å‡†çš„reactæ•°æ®è¯·æ±‚

```javascript
  /* æ ‡å‡†çš„reactæ•°æ®è¯·æ±‚ */
  const fetchData = url => {
    return fetch(url).then(res => res.json())
  };
  const Parent = () => {
    const [data, setData] = useState({
      /* ä¸€ä¸ªè¯·æ±‚ä¼šæœ‰å¦‚ä¸‹çš„å‡ ä¸ªåŸºæœ¬çŠ¶æ€ ä¾›å‰ç«¯ç»„ä»¶ä½¿ç”¨ */
      data: {}, // æ¥å£è¯·æ±‚æˆåŠŸå è¿”å›æ•°æ®çš„æ•°æ®æ ¼å¼
      loading: false, // æ˜¯å¦æ­£åœ¨è¯·æ±‚
      error: {}, // errorä¿¡æ¯
      // æ›´å¤š
    });
    /* åœ¨çˆ¶ç»„ä»¶è¯·æ±‚æ•°æ®åæ‹¿åˆ°dataå, é€šè¿‡props drillingæˆ–è€…contextç­‰æ–¹å¼ä¼ é€’ç»™ å­ç»„ä»¶ä½¿ç”¨ */
    useEffect(() => {
      fetchData('/api/demo').then(d => setData(d));
    }, []);
    return (
      <>
        <ChildA />
        <ChildB />
      </>
    )
  }
```

åœ¨çœŸå®çš„å¼€å‘åœºæ™¯ä¸­, ä»¥ä¸Šè¿™ç§æ¨¡å¼ä¸»è¦ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜
1. éœ€è¦é€šç”¨çš„æ¥å£æ•°æ®å¤„ç†æ–¹æ³•å¤„ç†æ•°æ®è¯·æ±‚çš„è¿”å›æ•°æ®ç»“æ„(data, loading, errorç­‰çŠ¶æ€)

2. æ¥å£å¤ç”¨æ€§å·®, é¢å¤–å¤„ç†[çŠ¶æ€æå‡](https://react.dev/learn/sharing-state-between-components#lifting-state-up-by-example).
å½“æœ‰ä¸åŒçš„ç»„ä»¶åœ¨åŒä¸€é¡µé¢ç”¨åˆ°åŒä¸€æ¥å£æ—¶, ä¸ºäº†ä¸ä½¿ç›¸åŒæ¥å£è°ƒç”¨å¤šæ¬¡, é€šå¸¸ä¼šä½¿ç”¨çŠ¶æ€æå‡å°†æ¥å£çŠ¶æ€æå‡è‡³å…¬å…±çˆ¶ç»„ä»¶å¤„ç†, é€šè¿‡props drillingæˆ–è€…contextç­‰æ–¹å¼ä¼ é€’ç»™
æŒ‰éœ€ä½¿ç”¨, å½“å­ç»„ä»¶æ•°é‡è¾ƒå¤š åŒæ—¶å±‚çº§åµŒå¥—çš„æ¯”è¾ƒæ·±æ—¶, è¯¥æ–¹æ¡ˆä¼šç‰¹åˆ«éº»çƒ¦, bugç‡ä¼šæå‡, å¼€å‘ä½“éªŒä¹Ÿä¸å¥½

## SWRåŸºç¡€ä½¿ç”¨
ä¸‹é¢æ¥çœ‹ä¸€ä¸‹åœ¨å¦‚ä¸Šçš„ç›¸åŒåœºæ™¯ä¸­ä½¿ç”¨SWRçš„å†™æ³•

```javascript
  import useSWR from 'swr';
  const fetchData = url => {
    return fetch(url).then(res => res.json())
  };
  const Parent => () => {
    return (
      <>
        <ChildA />
        <ChildB />
      </>
    )
  }
  const ChildA = () => {
    const { data, loading, error } = useSWR(`/api/demo`, fetchData);
  }
  const ChildB = () => {
    const { data, loading, error } = useSWR(`/api/demo`, fetchData);
  }
```

é€šè¿‡é‡‡ç”¨SWRçš„å†™æ³•æ¨¡å¼, ä»£ç æ›´åŠ å…·æœ‰å£°æ˜æ€§, æˆ‘ä»¬åªè¦æŒ‡å®šä»€ä¹ˆç»„ä»¶è°ƒç”¨ä»€ä¹ˆæ¥å£è·å–æ•°æ®å³å¯, åŒæ—¶SWRå†…ç½®çš„[ç¼“å­˜](https://swr.vercel.app/zh-CN/docs/advanced/cache)åŠŸèƒ½
å®Œç¾çš„è§£å†³äº†è¯·æ±‚å¤šæ¬¡è°ƒç”¨çš„é—®é¢˜, å¦‚æœä½ æ¸²æŸ“äº†Parentç»„ä»¶, æŸ¥çœ‹Networkä½ ä¼šå‘ç°è¯·æ±‚åªè°ƒç”¨äº†ä¸€æ¬¡, perfect!, no more lift state up!ğŸ˜

## ç«æ€é—®é¢˜
