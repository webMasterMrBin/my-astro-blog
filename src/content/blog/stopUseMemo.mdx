---
title: è¯·åˆ«å†æ»¥ç”¨useMemoäº† ğŸ˜­
pubDate: 2023-12-01
intro: useMemo everywhere? NO! æ»¥ç”¨useMemoå°†æ˜¯ä¸€åœºç¾éš¾, å­¦ä¹ ä½•æ—¶ä½¿ç”¨useMemoæ‰æ˜¯æœ‰æ„ä¹‰çš„
tag: react
author: lbsong
image: ../../assets/useMemo/stopUseMemo.webp
tableContents: [
  {
    id: '#æœ‰æ„ä¹‰çš„-usememo',
    name: 'æœ‰æ„ä¹‰çš„ useMemo',
    children: [
      {
        id: '#è·³è¿‡æ˜‚è´µçš„è®¡ç®—',
        name: 'è·³è¿‡æ˜‚è´µçš„è®¡ç®—',
      },
      {
        id: '#è®°å¿†å¦ä¸€ä¸ªhookçš„ä¾èµ–é¡¹',
        name: 'è®°å¿†å¦ä¸€ä¸ªhookçš„ä¾èµ–é¡¹'
      },
      {
        id: '#è·³è¿‡render',
        name: 'è·³è¿‡render'
      }
    ]
  },
  {
    id: '#ä½ çœŸçš„éœ€è¦-usememo-å—',
    name: 'ä½ çœŸçš„éœ€è¦ useMemo å—'
  },
  {
    id: '#æ€»ç»“',
    name: 'æ€»ç»“',
  }
]
readTime: '9'
---

**useMemo** æ¯«æ— ç–‘é—®æ˜¯ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–çš„å·¥å…·, ç„¶è€Œ, åœ¨æˆ‘çš„æ—¥å¸¸å·¥ä½œä¸­, å‘ç°æœ‰è¶Šæ¥è¶Šå¤šäººåœ¨æ‰€æœ‰åœºæ™¯ä¸‹éƒ½åœ¨ä½¿ç”¨å®ƒ,
è¿™æ ·ä½¿å¾—åº”ç”¨ä¸ä½†æ²¡æœ‰å¾—åˆ°ä¼˜åŒ–, åè€Œé™ä½äº†åº”ç”¨æ€§èƒ½å’Œä»£ç å¯è¯»æ€§ç»´æŠ¤æ€§ã€‚è¯•æƒ³ä¸€ä¸‹, ä½ å†™ä¸€ä¸ªç®€å•çš„æ²¡æœ‰ä»€ä¹ˆè¿ç®—ä»£ä»·çš„å‡½æ•°éƒ½ä¼šä½¿ç”¨memolizeå‡½æ•°å—? ç­”æ¡ˆæ˜¾ç„¶æ˜¯NO, å› æ­¤æ‰€æœ‰åœºæ™¯ ä½¿ç”¨ **useMemo**
æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚ä»¥ä¸‹æˆ‘å°†åˆ—å‡ºå‡ ä¸ª **useMemo** æœ‰ä»·å€¼çš„ä¾‹å­ã€‚

## æœ‰æ„ä¹‰çš„ useMemo

### è·³è¿‡æ˜‚è´µçš„è®¡ç®—

```javascript
  const App = ({ count }) = {
    /* æ¨¡æ‹Ÿä¸€ä¸ªéå¸¸è€—æ—¶çš„åŒæ­¥è®¡ç®—å‡½æ•° */
    const expensiveFilter = () => {
      /* delay 2000 æ¯æ¬¡æ‰§è¡Œè¯¥å‡½æ•°è‡³å°‘èŠ±è´¹ 2s + */
      const startTime = performace.now();
      let endTime = startTime;
      while (endTime - startTime < 2000) {
        endTime = performace.now();
      }
      doSomething();
    }
        /* 
      ä¼˜åŒ–å‰æ¯æ¬¡App render å expensiveFilter éƒ½ä¼šæ‰§è¡Œé˜»å¡è€—æ—¶çš„æ“ä½œå°†ä¼šåŠå…¶å½±å“æ€§èƒ½
    */
    const todos = expensiveFilter(count);
    /* 
      ä¼˜åŒ–å memoExpensiveFilter åªæœ‰å½“ç”¨åˆ°çš„countå˜é‡å˜åŒ–åæ‰ä¼šæ‰§è¡Œ,
      è·³è¿‡äº†å¤šä½™çš„renderè€Œé€ æˆçš„è°ƒç”¨çš„è€—æ—¶
    */
    const memoExpensiveFilter = useMemo(() => expensiveFilter(), [count]);
  }
  
```

### è®°å¿†å¦ä¸€ä¸ªhookçš„ä¾èµ–é¡¹

```javascript
  // æ¯æ¬¡renderéƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¼•ç”¨å¯¹è±¡ åœ¨è¿™ç§æƒ…å†µä¸‹ useEffectä¼šæ— é™è°ƒç”¨
  const depency = () => {};

  /* ä¿®æ”¹å memoDpency æ˜¯ä¸€ä¸ªç¨³å®šçš„å€¼ å¯ä»¥å®‰å…¨ä½œä¸ºå…¶ä»–hookçš„ä¾èµ–é¡¹ */
  const memoDepency = useMemo(() => depency, []);

  useEffect(() => {}, [depency])
```

### è·³è¿‡render

```javascript
  /* å¯¹è±¡å­—é¢é‡ä½œä¸ºpropsä¼ é€’ç»™å­ç»„ä»¶çš„æ—¶å€™, ç”±äºæ¯æ¬¡render propsObjéƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¼•ç”¨,
  Childä¼šé¢å¤–render */
  const propsObj = {};

  <Child {...propsObj} />

  /* ä¼˜åŒ–å */
  const memoPropsObj = useMemo(() => props, []);

  <Child {...memoOropsObj} /> 
```

ä½ å¯èƒ½è§‰å¾—ä»¥ä¸Šè¿™æ ·memoå¤„ç†çš„å¯¹è±¡é€šè¿‡propsä¼ é€’ Childç»„ä»¶å°±ä¸ä¼šæœ‰å¤šä½™çš„renderäº†? é”™äº†, ç”±äºReacté»˜è®¤çš„è¡Œä¸º,
çˆ¶ç»„ä»¶renderåå­ç»„ä»¶ä¹Ÿä¼šé»˜è®¤render, å› æ­¤è¦è·³è¿‡renderçš„æ­£ç¡®æ–¹æ³•ä¸º

```javascript
  const memoPropsObj = useMemo(() => props, []);

  React.memo(<Child {...memoOropsObj} />)
```

å¦‚ä¸Šç”¨æ³•, ç»è¿‡æˆ‘çš„æ—¥å¸¸å‘ç°, ä¸ºæ»¥ç”¨ **useMemo** çš„é‡ç¾åŒºä¹‹ä¸€, è®¸å¤šåŒäº‹memoä¸€ä¸ªå¼•ç”¨å¯¹è±¡, å°±æ˜¯ä¸ºäº†ä½¿å¾—ä¼ é€’ç»™å­ç»„ä»¶æ—¶,
è·³è¿‡å­ç»„ä»¶çš„render, ä½†æ˜¯ç”±äºå¹¶æ²¡æœ‰å­ç»„ä»¶memoå¤„ç†, å¯¼è‡´è¿™ä¸ª **useMemo** å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨, åè€Œè¿˜å¢åŠ äº†å†…å­˜è´Ÿæ‹…å’Œä»£ç å¤æ‚æ€§

## ä½ çœŸçš„éœ€è¦ useMemo å—?

åœ¨å­¦ä¹ æœ‰ç”¨çš„ **useMemo** å, æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å‡ ä¸ª **bad case**ã€‚

### useMemo å­˜å‚¨åŸå§‹ç±»å‹å€¼

**Boolean**, **String** è¿™ç±»åŸå§‹ç±»å‹å€¼ç”±äºä¸æ˜¯å¼•ç”¨ç±»å‹å€¼, å³ä¾¿ç»„ä»¶re-render, ä»–ä»¬ä¹Ÿä¿æŒä¸å˜, æ— éœ€ä½¿ç”¨ **useMemo** åŒ…è£…

### ä½å¤æ‚åº¦å‡½æ•°è®¡ç®— ä»ç„¶ä½¿ç”¨ useMemo

è¿™ç±»ç”¨æ³•ä¸ºæ»¥ç”¨ **useMemo** çš„é‡ç¾åŒºä¹‹ä¸€, é€šå¸¸å‡ºç°åœ¨ä¸äº†è§£ memoåŸç†çš„åŒå­¦èº«ä¸Š, å¦‚ä¸‹

```javascript
  const memoFilterSomething = useMemo(() => {
    /* arrayTestä¸ºæ•°ç»„, è®¡ç®—æˆæœ¬éœ€è¦åç»­è¡¡é‡, å¦‚æœè®¡ç®—æˆæœ¬è¿‡å¤§, åˆ™éœ€è¦memoå¤„ç†
      å¦åˆ™, æ²¡æœ‰å¿…è¦åœ¨å¼€å‘é˜¶æ®µæ— è„‘çš„ä½¿ç”¨memoåŒ…è£…, ç”¨å†…å­˜æ¢æ€§èƒ½, åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å¾—ä¸å¿å¤±
     */
    return ArrayTest.filter()
  }, [])
```

åœ¨æˆ‘çœ‹æ¥, ç»å¤§éƒ¨åˆ†ä½å¤æ‚åº¦ **O(n)** æˆ–è€…å°‘é‡å…ƒç´ çš„åœºæ™¯ä¸‹éƒ½æ²¡æœ‰å¿…è¦ä½¿ç”¨ **useMemo** è®°ä½jsä¸­å„ç±»å¯¹è±¡, å…³äºå¦‚ä½•è¡¡é‡ä¸€ä¸ªæ–¹æ³•è®¡ç®—é‡æ˜¯å¦æ˜‚è´µ,
æŸ¥çœ‹å®˜æ–¹çš„å»ºè®® [How to tell if a calculation is expensive](https://react.dev/reference/react/useMemo#skipping-expensive-recalculations)

## æ€»ç»“
1. åˆ«æŠŠ **useMemo** å½“æˆå¿…éœ€çš„è¯­æ³•, å®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ, **useMemo everywhere** åªä¼šæ¯äº†æˆ‘ä»¬çš„åº”ç”¨, æ¯•ç«Ÿä½ ä¸ä¼šæŠŠæ¯ä¸€ä¸ªjsæ–¹æ³•éƒ½ä½¿ç”¨ **memolize** å¤„ç†å¯¹å§?ğŸ˜„
2. ä½¿ç”¨ **react-dev-tools** å®šä½ç»„ä»¶æ€§èƒ½, è‹¥å‘ç°ç»„ä»¶renderæ¬¡æ•°è¿‡å¤š, æˆ–è€…æ‰§è¡Œæ—¶é—´è¿‡é•¿æ‰æœ‰å¿…è¦ä½¿ç”¨ **useMemo**


