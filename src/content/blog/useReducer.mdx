---
title: useReducerä¸­çš„å„ç±»reducer
pubDate: 2023-10-15
intro: actionless reduceråŠæ›´å¤šreducerç”¨æ³•, å­¦ä¹ å„ç±»reducerå¸®åŠ©ä½ æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡
tag: react
author: lbsong
image: ../../assets/useReducer/useReducer.png
tableContents: [
  {
    id: '#actionless-reducer',
    name: 'Actionless reducer',
    children: [
      {
        id: '#boolean-state-çŠ¶æ€åˆ‡æ¢',
        name: 'Boolean state çŠ¶æ€åˆ‡æ¢'
      }
    ]
  },
  { id: '#stateless-reducer', name: 'Stateless reducer' },
  { id: '#æ€»ç»“', name: 'æ€»ç»“' }
]
readTime: '12'
---

useReducer ä¸ä»…ä»…é€‚ç”¨äºå¤æ‚çš„çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œå®ƒè¿˜å¯ä»¥ç”¨äºéå¸¸ç®€å•çš„çŠ¶æ€æ›´æ–°ã€‚reducerçš„ä¸¤ä¸ªå‚æ•°ä¹‹ä¸€å¯ä»¥è¢«å¿½ç•¥ï¼Œä½¿å…¶æˆä¸ºæ— æ“ä½œæˆ–æ— çŠ¶æ€ã€‚

æˆ‘è®¤ä¸º usereducer éå¸¸å¥½ï¼Œä½†æ²¡æœ‰å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œç›¸å useState åˆ™è¢«è¿‡åº¦åˆ©ç”¨ã€‚

äººä»¬å¾ˆå®¹æ˜“è®¤ä¸º useReducer åªæ˜¯ä¸ºäº†ç®¡ç†å¤æ‚çš„çŠ¶æ€ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚å®ƒæ˜¯ä¸ºäº†å°è£…çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œä»è€Œé™åˆ¶çŠ¶æ€æ›´æ–°æ–¹å¼ã€‚å› æ­¤ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºç®€å•çš„çŠ¶æ€æ›´æ–°ï¼Œä»¥è‡³äºreduceråªéœ€è¦ä¸€ä¸ªåŠ¨ä½œã€‚æ¥ä¸‹æ¥æˆ‘å°†æ€»ç»“ä¸€äº›reducerçš„ç§ç±»,å’Œé€‚ç”¨åœºæ™¯æ¥å¯¹æ¯”å®ƒå’ŒuseStateçš„åŒºåˆ«, ä»¥åŠæˆ‘ä¸ºä»€ä¹ˆæ›´å–œæ¬¢ä½¿ç”¨useReducer

## Actionless Reducer

#### Boolean state çŠ¶æ€åˆ‡æ¢

![toggle](../../assets/useReducer/toggle.svg)
å¦‚ä¸ŠçŠ¶æ€åˆ‡æ¢çš„åœºæ™¯éå¸¸å¸¸è§, åœ¨antdçš„ç»„ä»¶æ¯”å¦‚Switchæˆ– Modal å¼¹çª—åˆ‡æ¢å¼€å…³çŠ¶æ€åœºæ™¯ä¸­éƒ½ä¼šç”¨åˆ°, ä¸‹é¢æ˜¯ä½¿ç”¨ **useState** å®ç°ä¸Šè¿°çš„åœºæ™¯

```javascript
  const [isOpen, setIsOpen] = useState(false);
  /* éœ€è¦é¢å¤–å®šä¹‰ä¸€ä¸ªåˆ‡æ¢çŠ¶æ€çš„å‡½æ•° */
  const toggleOpen = () => setIsOpen(state => !state);
```
å¦‚æœä¸Šè¿°è‡ªå®šä¹‰çš„ **toggleOpen** éœ€è¦ä½œä¸º **useEffect** çš„ä¾èµ–, é‚£ä¹ˆéœ€è¦è¿›è¡Œé¢å¤–å¤„ç†
```javascript
  /* ä½¿ç”¨useCallback è®°å¿†, ç¡®ä¿æ¯æ¬¡renderå toggleOpenéƒ½æ˜¯å”¯ä¸€ä¸å¯å˜çš„, é‚£ä¹ˆå°±å¯ä»¥å®‰å…¨ä½œä¸ºuseEffectä¾èµ–æˆ–è€…ä¼ é€’ç»™å­ç»„ä»¶åšReact.memoå¤„ç† */
  const toggleOpen = useCallback(toggleOpen, []);
```
å¦‚ä¸Š, ä½¿ç”¨useStateå®ç°çŠ¶æ€åˆ‡æ¢å‡½æ•°éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™åˆ‡æ¢é€»è¾‘, å¹¶ä¸”è¿˜è¦æ³¨æ„å¯å˜æ€§çš„é—®é¢˜, ä¸‹é¢æ¥çœ‹çœ‹ä½¿ç”¨ **useReducer** å¦‚ä½•å®ç°
```javascript
  /* reducerå‡½æ•°æ²¡actionå‚æ•°, åªæœ‰åˆ‡æ¢çŠ¶æ€çš„é€»è¾‘, å³ä¸ºactionless reducer */
  const [isOpen, toggleOpen] = useReducer(state => !state, false);
```
å¦‚ä¸Š **useReducer** å®ç°çš„toggleOpenæ–¹æ³•, æ¯”è¾ƒ useState å®ç°çš„æœ‰ ä¸¤ç‚¹å¥½å¤„
1. è‡ªå¸¦ useCallback è®°å¿†å¤„ç†, ä¸ç”¨é¢å¤–å¤„ç†
2. ç®€æ´ä¸”åªé™åˆ¶äº†ä¸€ç§çŠ¶æ€ç±»å‹, å³æ¯æ¬¡è°ƒç”¨ **toggleOpen** openåªå¯èƒ½æ˜¯boolean, åœ¨ Switch å’Œ Modalç»„ä»¶çš„åˆ‡æ¢å¼€å…³çŠ¶æ€å°¤å…¶é€‚ç”¨, å¦‚æœä½¿ç”¨ useState çš„ setIsOpen, å¯èƒ½å­˜åœ¨è¯¯è®¾ç½®æˆæ•°ç»„ç­‰å…¶ä»–ç±»å‹çš„çŠ¶æ€ 

#### One-way Boolean state å•å‘çŠ¶æ€åˆ‡æ¢

åŸºäºå¦‚ä¸Šçš„çŠ¶æ€åˆ‡æ¢actionless reducerè¿˜æœ‰ä¸€ç§å•å‘çš„çŠ¶æ€è®¾ç½® Reducer
```javascript
  /* æ— actionä¹Ÿæ— stateçš„ reducer, è°ƒç”¨enableæ–¹æ³• å°†å›ºå®šæŠŠçŠ¶æ€ ä»false => true */
  const [isEnabled, enable] = useReducer(() => true, false);
```

#### Increment Reducer ç´¯åŠ çŠ¶æ€

```javascript
  /* increment çš„dispatch å¯ä½œä¸ºå¼ºåˆ¶renderæ–¹æ³•ä½¿ç”¨ */
  const [count, increment: forceUpdate] = useReducer(count => count + 1, 0)
```

#### Optional Action Reducer å¯é€‰action

è¯¥reduceræ˜¯ çŠ¶æ€åˆ‡æ¢çš„å˜ä½“

```javascript
  const [isOpen, toggleOpen] = useReducer((state, isOpen) => isOpen ?? !state, false);
  toggleOpen(); // true
  toggleOpen(false) // false æ˜ç¡®è®¾ç½®çŠ¶æ€ æ— éœ€å…³å¿ƒä¸Šæ¬¡çŠ¶æ€
  toggleOpen(true) // true
```

## Stateless Reducer

æ— çŠ¶æ€reducerå¿½ç•¥äº†stateå‚æ•°é’ˆå¯¹æ¯ä¸ªç‰¹å®šçš„actionåšä¸åŒçš„æ“ä½œ, å¯ä»¥éœ€è¦å¯¹ç‰¹å®šçš„actionåšåŒæ ·çš„é€»è¾‘, é‚£ä¹ˆå¯ä»¥é¿å…é‡å¤çš„é€»è¾‘

```javascript
  /* ä¸€ä¸ªæ ¹æ®å¼‚æ­¥ç»“æœè¿”å› è¯·æ±‚çŠ¶æ€çš„ stateless reducer
    è¿™ä¸ªæ —å­ä¸­æˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸åŒçš„actionç±»å‹è¿”å›å¯¹åº”çš„ä¸åŒçŠ¶æ€å³å¯, æ— éœ€å…³å¿ƒstate, 
    åŒç† stateless reducer è¿˜å¯ä»¥ç”¨äºæ›´å¤šä¸šåŠ¡é€»è¾‘ä¸­ ç»™å®šå¯¹åº”action å¤„ç†å›ºå®šçš„ç›¸åŒé€»è¾‘
  */
  function asyncLoadAction(state, action) {
    switch (action.type) {
      case 'loading':
        return { status: 'loading', data: null, error: null }
      case 'success':
        return { status: 'success', data: {}, error: null }
      case 'error':
        return { status: 'error', data: null, error: new Error('wrong') }
      default: {
        throw new Error(`Unhandled action type: ${action.type}`);
      }
    }
  }
```

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šçš„å‡ ä¸ªreducerçš„ç”¨æ³•, æ˜¯ä¸æ˜¯è§‰å¾— useReducer æ¯” useState å¼ºå¤§äº†å¾ˆå¤šå‘¢ğŸ˜, 
è™½ç„¶useStateç›¸æ¯”useReduceræ›´ç›´æ¥, ä½†æ˜¯åœ¨å¤æ‚çš„çŠ¶æ€å¤„ç†ä¸‹, åˆ†æ•£çš„useStateå¸¦æ¥è®¸å¤šé—®é¢˜, å› æ­¤ä»¥ä¸‹æ˜¯æˆ‘æ€»ç»“çš„æˆ‘è®¤ä¸ºuseReducerå¥½äºuseStateçš„å‡ ä¸ªä¼˜ç‚¹
1. useReducer é›†ä¸­ç¼–å†™çŠ¶æ€ç®¡ç†é€»è¾‘, æ›´æ˜“ç»´æŠ¤, ç¼–å†™ä¸€ä¸ªreducerè™½ç„¶å¤šäº†å¾ˆå¤šçŠ¶æ€çš„é¢å¤–ä»£ç , ä½†æ˜¯éšç€é¡¹ç›®çš„åºå¤§, useReducerä¼šæ›´å®¹æ˜“  **debugger**, çŠ¶æ€çš„å˜æ¢æ›´åŠ å¯æ§
2. ç®€åŒ–äº†ä»£ç , åœ¨ä¸€äº›åœºæ™¯ä¸­ å¦‚åˆ‡æ¢çŠ¶æ€, ç¬¬ä¸€ä¸ªç”¨æ³•actionless reducerç›¸æ¯”useStateçš„å®ç°æ›´ç²¾ç®€ä¹Ÿæ›´åˆé€‚
3. æ— éœ€å¤„ç†å›è°ƒå‡½æ•°çš„é€»è¾‘, useReducerçš„dispatchè‡ªå¸¦memoå¤„ç†ğŸ˜